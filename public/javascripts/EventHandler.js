import DivContents from"./DivContents2.js";import WebStorage from"./WebStorage.js";export default class EventHandler{constructor(e,t){this.controller=new AbortController,this.SIGN_OFFS=t,this.nightCounter=0,this.signedIn=[],this.patrollers=e,this.dayNight="",this.halfDay=!1,this.counter=[1,1,1,1,1,1,1],this.isWeekend="",this.populated=0,this.extraNight=!1,this.isAdmin=!1,this.isLocalStorage=!1,this.buttons=document.querySelectorAll("input[type=button]"),this.handleNarnia(),this.handleFixButton(),this.handleWhichForm(),this.handleSignOnButtons(),EventHandler.stopNaughtyKeys()}handleFixButton(){let e=!1;document.getElementById("fixButton").addEventListener("click",(()=>{let t=prompt("Password: ");for(let n of this.patrollers)n.ID===t&&n.LEADER&&(e=!0);if(e)return localStorage.clear(),location.reload(),!1;alert("Incorrect Password")}))}handleWhichForm(){document.querySelectorAll('input[name="formDisplay"]').forEach((e=>{let t,n=1;e.addEventListener("change",t=e=>{document.getElementById("masterDiv").style.display="block";let t=e.target.value;if("weekend"===t){document.getElementById("team.0").style.display="none",this.isWeekend=!0,this.dayNight="Day";let e=1;const t=6;for(;e<=t;)document.getElementById("team.1").style.display="block",document.getElementById(`team.${e}`).style.display="block",e++;document.getElementById("formSubmit").disabled=!0,document.getElementById("dayNight").innerText="Day Shift"}else if("weekday"===t){document.getElementById("team.0").style.display="block",this.isWeekend=!1,this.dayNight="Day";const e=6;for(;n<=e;)document.getElementById(`team.${n}`).style.display="none",n++;document.getElementById("formSubmit").disabled=!0,document.getElementById("dayNight").innerText="Day Shift"}else{const e=["","7:00","7:15","7:30","7:45","8:00","8:15","8:30","8:45"];let t=document.querySelectorAll("fieldset");this.isWeekend=!1,this.dayNight="Night";for(let e=1;e<t.length;e++)document.getElementById(`team.${e}`).style.display="none";for(;n<e.length;)document.getElementById("team.0").insertAdjacentHTML("beforeend",DivContents.getNightRaceDivs(0,n,e)),DivContents.getDivs(0,n,null,e,!1),document.getElementById(`joinNight.${n}`).addEventListener("click",(e=>{let t=Number(e.target.id.substr(10,1));document.getElementById("joinTeam.0").disabled=!0,this.throwModal(0,t)}),{signal:this.controller.signal}),document.getElementById(`patrollerID.0.${n}`).disabled=!0,document.getElementById(`radioNum.0.${n}`).disabled=!0,document.getElementById(`guest.0.${n}`).disabled=!0,n++;document.getElementById("patrollerID.0.1").required=!0,document.getElementById("joinTeam.0").value="EXTRA Sign On (! ONLY click this if all race time slots are filled or you cannot do race course duty !)",document.getElementById("dayNight").innerText="Night Shift"}document.getElementById("chooser").style.display="none",document.getElementById("chosen").style.display="block",WebStorage.populateLocalStorage(null,null,t)})}))}handleSignOnButtons(){let e=9;for(let t=0;t<this.buttons.length;t++)this.buttons[t].addEventListener("click",(n=>{let l=Number(this.buttons[t].id.substr(9,1));if(6===l&&0===this.populated){let e=!1,t=prompt("What is your Patroller ID?");for(let n of this.patrollers){if(n.ID===t&&n.LEADER){e=!0,document.getElementById(`team.${l}`).insertAdjacentHTML("beforeend",DivContents.getDivs(l,this.counter[l],n.LEADER)),this.throwModal(6,this.counter[6]),document.getElementById("patrollerID.7.1").value=n.ID,document.getElementById(`halfDay.${l}.${this.counter[l]}`).addEventListener("click",(e=>{this.handleHalfDay(e.target.id.substring(8,9),e.target.id.substring(10,11))})),this.handleUndo(l,this.counter[l]);let t=new Event("change");document.getElementById("patrollerID.7.1").dispatchEvent(t);break}for(let e of this.buttons)document.getElementById(e.id).disabled=!1}e||alert("Incorrect ID for leadership/trainers team. Please try again or sign on to a different team.")}else 0===l&&"Night"===this.dayNight?(document.getElementById(`team.${l}`).insertAdjacentHTML("beforeend",DivContents.getExtraNightDiv(l,e)),this.extraNight=!0,this.throwModal(l,e),e++):(document.getElementById(`team.${l}`).insertAdjacentHTML("beforeend",DivContents.getDivs(l,this.counter[l])),this.isAdmin&&1!==this.populated||document.getElementById(`halfDay.${l}.${this.counter[l]}`).addEventListener("click",(e=>{this.handleHalfDay(e.target.id.substring(8,9),e.target.id.substring(10,11))})),l>0&&this.handleUndo(l,this.counter[l]),this.isAdmin||(document.getElementById(`joinTeam.${l}`).disabled=!0,this.throwModal(l,this.counter[l])),1===this.populated&&0!==l&&this.handleAdmin(l,this.counter[l]),1===this.populated&&this.counter[l]++)}))}handleNarnia(){document.getElementById("nspLogo").addEventListener("click",(()=>{let t=!1,n=prompt("Password: ");for(let e of this.patrollers)e.ID===n&&e.LEADER&&(t=!0);t?(document.getElementById("modalDiv").style.display="block",document.getElementById("modalTitle").insertAdjacentHTML("beforeend","<h3>Updating Patroller Shifts</h3>"),document.getElementById("dataEntryDiv").insertAdjacentHTML("beforeend",DivContents.getDivs(8,1)),document.getElementById("modalSubmitButton").disabled=!0,document.getElementById("fixButton").classList.add("disabled"),document.getElementById("nspLogo").classList.add("disabled"),document.getElementById("modalPatrollerID.8.1").focus(),document.getElementById("modalCancelButton").addEventListener("click",(()=>{document.getElementById("fixButton").classList.remove("disabled"),document.getElementById("nspLogo").classList.remove("disabled"),document.getElementById("modalPatrollerID.8.1").value="",document.getElementById("modalName.8.1").value="",document.getElementById("modalDays.8.1").value="",document.getElementById("modalNights.8.1").value="",document.getElementById("modalHalfs.8.1").value="",document.getElementById("modalTitle").innerHTML="",document.getElementById("dataEntryDiv").innerHTML="",document.getElementById("modalDiv").style.display="none"})),document.getElementById("modalPatrollerID.8.1").addEventListener("change",(()=>{let t=!1;if(""!==document.getElementById("modalPatrollerID.8.1").value){for(let n=0;n<this.patrollers.length;n++)if(n<this.patrollers.length&&Number(document.getElementById("modalPatrollerID.8.1").value)===Number(this.patrollers[n].ID)){t=!0,document.getElementById("modalName.8.1").value=`${this.patrollers[n].FIRST_NAME} ${this.patrollers[n].LAST_NAME}`,document.getElementById("modalDays.8.1").value=this.patrollers[n].DAYS,document.getElementById("modalDays.8.1").addEventListener("change",(()=>{document.getElementById("modalDays.8.1").reportValidity()?(document.getElementById("modalShifts.8.1").value=e(),document.getElementById("modalSubmitButton").disabled=!1):(document.getElementById("modalSubmitButton").disabled=!0,document.getElementById("modalDays.8.1").value="")})),document.getElementById("modalNights.8.1").value=this.patrollers[n].NIGHTS,document.getElementById("modalNights.8.1").addEventListener("change",(()=>{document.getElementById("modalNights.8.1").reportValidity()?(document.getElementById("modalShifts.8.1").value=e(),document.getElementById("modalSubmitButton").disabled=!1):(document.getElementById("modalSubmitButton").disabled=!0,document.getElementById("modalNights.8.1").value="")})),document.getElementById("modalHalfs.8.1").value=this.patrollers[n].HALF_DAYS,document.getElementById("modalHalfs.8.1").addEventListener("change",(()=>{document.getElementById("modalHalfs.8.1").reportValidity()?(document.getElementById("modalShifts.8.1").value=e(),document.getElementById("modalSubmitButton").disabled=!1):(document.getElementById("modalSubmitButton").disabled=!0,document.getElementById("modalHalfs.8.1").value="")})),document.getElementById("modalShifts.8.1").value=e();break}t||(alert("Invalid patroller number."),document.getElementById("modalPatrollerID.8.1").value="")}})),document.getElementById("modalSubmitButton").addEventListener("click",(()=>{for(let e=0;e<this.patrollers.length;e++)if(Number(document.getElementById("modalPatrollerID.8.1").value)===Number(this.patrollers[e].ID)){this.patrollers[e].DAYS=document.getElementById("modalDays.8.1").value,this.patrollers[e].NIGHTS=document.getElementById("modalNights.8.1").value,this.patrollers[e].HALF_DAYS=document.getElementById("modalHalfs.8.1").value;break}for(let e=0;e<this.signedIn.length;e++)if(this.signedIn.length>0&&Number(document.getElementById("modalPatrollerID.8.1").value)===Number(this.signedIn[e].ID)){this.signedIn[e].DAYS=document.getElementById("modalDays.8.1").value,this.signedIn[e].NIGHTS=document.getElementById("modalNights.8.1").value,this.signedIn[e].HALF_DAYS=document.getElementById("modalHalfs.8.1").value,WebStorage.populateLocalStorage(this.signedIn[e],this.signedIn[e].POSITION_TEAM);break}document.getElementById("formSubmit").disabled=!1,document.getElementById("fixButton").classList.remove("disabled"),document.getElementById("nspLogo").classList.remove("disabled");for(let e of this.buttons)document.getElementById(e.id).disabled=!1;document.getElementById("modalPatrollerID.8.1").value="",document.getElementById("modalName.8.1").value="",document.getElementById("modalDays.8.1").value="",document.getElementById("modalNights.8.1").value="",document.getElementById("modalHalfs.8.1").value="",document.getElementById("modalTitle").innerHTML="",document.getElementById("dataEntryDiv").innerHTML="",document.getElementById("modalDiv").style.display="none",this.updateDays()}))):alert("Incorrect Password")}));let e=function(){return Number(document.getElementById("modalDays.8.1").value)+Number(document.getElementById("modalNights.8.1").value)+Number(document.getElementById("modalHalfs.8.1").value/2)}}throwModal(e,t){let n,l=!1,d=e,o=t;document.getElementById("modalDiv").style.display="block","Night"===this.dayNight?(document.getElementById("modalTitle").insertAdjacentHTML("beforeend","<h3>Joining Night Team</h3>"),document.getElementById("dataEntryDiv").insertAdjacentHTML("beforeend",DivContents.getDivs(7,1,null,null,null,!0))):"Day"!==this.dayNight||this.isWeekend?e<5&&e>0?(document.getElementById("modalTitle").insertAdjacentHTML("beforeend",`<h3>Joining Team: ${e}</h3>`),document.getElementById("dataEntryDiv").insertAdjacentHTML("beforeend",DivContents.getDivs(7,1))):5===e?(document.getElementById("modalTitle").insertAdjacentHTML("beforeend","<h3>Joining Team: CANDIDATES/AUXILIARY/ALUMNI</h3>"),document.getElementById("dataEntryDiv").insertAdjacentHTML("beforeend",DivContents.getDivs(7,1,null,null,!0))):(document.getElementById("modalTitle").insertAdjacentHTML("beforeend","<h3>Joining Team: LEADERSHIP/TRAINERS</h3>"),document.getElementById("dataEntryDiv").insertAdjacentHTML("beforeend",DivContents.getDivs(7,1))):(document.getElementById("modalTitle").insertAdjacentHTML("beforeend","<h3>Joining Weekday Team</h3>"),document.getElementById("dataEntryDiv").insertAdjacentHTML("beforeend",DivContents.getDivs(7,1))),document.getElementById("modalSubmitButton").disabled=!0,document.getElementById("fixButton").classList.add("disabled"),document.getElementById("nspLogo").classList.add("disabled"),document.getElementById("patrollerID.7.1").focus(),"Night"!==this.dayNight&&document.getElementById("halfDay.7.1").addEventListener("click",(()=>{5===e?this.handleHalfDay(7,1,!0):this.handleHalfDay(7,1,!1)})),document.getElementById("modalCancelButton").addEventListener("click",(()=>{document.getElementById("fixButton").classList.remove("disabled"),document.getElementById("nspLogo").classList.remove("disabled"),this.handleUndo(d,o,7)})),document.getElementById("patrollerID.7.1").addEventListener("change",(()=>{if(""!==document.getElementById("patrollerID.7.1").value){for(let e=0;e<this.patrollers.length;e++){if(e<this.signedIn.length&&Number(this.signedIn[e].ID)===Number(document.getElementById("patrollerID.7.1").value)){alert("You are already logged in."),document.getElementById("patrollerID.7.1").value="";break}if(Number(this.patrollers[e].ID)===Number(document.getElementById("patrollerID.7.1").value)){n=e,l=!0,this.completeDivChange(7,1,n),document.getElementById("radioNum.7.1").required=!0,document.getElementById("radioNum.7.1").addEventListener("change",(()=>{this.validateRadio(7,1)&&(document.getElementById("modalSubmitButton").disabled=!1)}));break}}!0!==l?(alert("Invalid ID number. Please try again..."),document.getElementById("patrollerID.7.1").value=""):document.getElementById("modalSubmitButton").addEventListener("click",(()=>{document.getElementById("formSubmit").disabled=!1,document.getElementById("fixButton").classList.remove("disabled"),document.getElementById("nspLogo").classList.remove("disabled");for(let e of this.buttons)document.getElementById(e.id).disabled=!1;this.divTransition=!0,this.changePatrollerDiv(d,o,n),this.handlePrintFormButton()}))}else this.clearDiv(7,1)}))}changePatrollerDiv(e,t,n){document.getElementById(`patrollerID.${e}.${t}`).value=document.getElementById("patrollerID.7.1").value,document.getElementById(`name.${e}.${t}`).value=document.getElementById("name.7.1").value,document.getElementById(`radioNum.${e}.${t}`).value=document.getElementById("radioNum.7.1").value,document.getElementById(`rating.${e}.${t}`).value=document.getElementById("rating.7.1").value,document.getElementById(`time.${e}.${t}`).value=document.getElementById("time.7.1").value,"Night"!==this.dayNight?document.getElementById("halfDay.7.1").checked?(document.getElementById(`halfDay.${e}.${t}`).checked=!0,5!==e&&(document.getElementById(`guest.${e}.${t}`).disabled=!0)):document.getElementById(`halfDay.${e}.${t}`).checked=!1:"Night"===this.dayNight&&t<=8&&(document.getElementById(`joinNight.${t}`).classList.add("disabled"),this.controller.abort()),5!==e&&(document.getElementById(`guest.${e}.${t}`).value=document.getElementById("guest.7.1").value,this.updatePatrollerInfo(document.getElementById("patrollerID.7.1").value,document.getElementById("guest.7.1").value,"guest"),document.getElementById(`guest.${e}.${t}`).addEventListener("change",(()=>{this.updatePatrollerInfo(this.patrollers[n].ID,document.getElementById(`guest.${e}.${t}`).value,"guest")})),document.getElementById(`guest.${e}.${t}`).disabled=!1),document.getElementById(`radioNum.${e}.${t}`).addEventListener("change",(()=>{this.validateRadio(e,t)&&this.updatePatrollerInfo(this.patrollers[n].ID,document.getElementById(`radioNum.${e}.${t}`).value,"radio")})),document.getElementById("modalTitle").innerHTML="",document.getElementById("dataEntryDiv").innerHTML="",document.getElementById("modalDiv").style.display="none",document.getElementById(`radioNum.${e}.${t}`).disabled=!1,this.completeDivChange(e,t,n)}completeDivChange(e,t,n){let l=Number(this.patrollers[n].DAYS),d=Number(this.patrollers[n].NIGHTS),o=Number(this.patrollers[n].HALF_DAYS),a=Number(o/2);document.getElementById(`patrollerID.${e}.${t}`).readOnly=!0,"Night"!==this.dayNight?l++:d++;let i=Number(l+d+a);7===e&&(document.getElementById(`days.${e}.${t}`).value=i),7===e?this.populateDiv(7,1,n,l,d,o,i):(this.populateDiv(e,t,n,l,d,o,i),"Night"!==this.dayNight&&this.handleHalfDay(e,t),7!==e&&this.handleSignOffs(e,t),this.divTransition=!1,this.isAdmin&&(this.isAdmin=!1)),this.isWeekend&&7!==e&&this.handleAdmin(e,t),0===this.populated&&this.counter[e]++}validateRadio(e,t){let n=!1,l=!1;for(let n of this.signedIn)document.getElementById(`radioNum.${e}.${t}`).value===n.RADIO&&"0"!==n.RADIO&&(l=!0);return document.getElementById(`radioNum.${e}.${t}`).reportValidity()?l?(alert("Radio already in use...."),document.getElementById(`radioNum.${e}.${t}`).value="",document.getElementById("formSubmit").disabled=!0,7===e&&(document.getElementById("modalSubmitButton").disabled=!0)):(n=!0,document.getElementById("formSubmit").disabled=!1,7===e&&(document.getElementById("modalSubmitButton").disabled=!1)):7===Number(e)&&(document.getElementById("modalSubmitButton").disabled=!0),n}updatePatrollerInfo(e,t,n){for(let l of this.signedIn)if(Number(l.ID)===Number(e)){if(this.divTransition||("radio"===n?l.RADIO=t:"guest"===n?l.GUEST=t:"halfDaysDown"===n?(this.halfDay=!1,l.TODAY_HALF=!1,l.TOTAL_DAYS=t,l.DAYS++,l.HALF_DAYS>0&&!this.divTransition&&l.HALF_DAYS--):"halfDaysUp"===n?(this.halfDay=!0,l.TODAY_HALF=!0,l.TOTAL_DAYS=t,l.HALF_DAYS++,l.DAYS>0&&!this.divTransition&&l.DAYS--):"Nights"===this.dayNight&&l.NIGHTS++),0===this.populated){let e="";e=this.isWeekend?"weekend":"Night"===this.dayNight?"night":"weekday",WebStorage.populateLocalStorage(l,l.POSITION_TEAM)}break}}populateDiv(e,t,n,l,d,o,a){let i,m=new Date,s=m.getMinutes();s<10&&(s=`0${s}`);let r=!1;if(document.getElementById(`time.${e}.${t}`).value||(document.getElementById(`time.${e}.${t}`).value=`${m.getHours()}:${s}`),document.getElementById(`race.${e}.${t}`)&&(i=document.getElementById(`race.${e}.${t}`).value),7!==e&&"Night"!==this.dayNight&&!0===document.getElementById(`halfDay.${e}.${t}`).checked&&(r=!0),7!==e){let m={ID:Number(this.patrollers[n].ID),RADIO:document.getElementById(`radioNum.${e}.${t}`).value,NAME:`${this.patrollers[n].FIRST_NAME} ${this.patrollers[n].LAST_NAME}`,LEADER:this.patrollers[n].LEADER,RATING:this.patrollers[n].RATING,TIME:document.getElementById(`time.${e}.${t}`).value,DAYS:l,TEAM:e,RACE:i,NIGHTS:d,HALF_DAYS:o,TOTAL_DAYS:a,SNOWMOBILE:this.patrollers[n].SNOWMOBILE,TOBOGGAN:this.patrollers[n].TOBOGGAN,SCAVENGER:this.patrollers[n].SCAVENGER,CPR:this.patrollers[n].CPR,CHAIR:this.patrollers[n].CHAIR,TODAY_HALF:r,POSITION_TEAM:this.counter[e]};5!==e&&document.getElementById(`guest.${e}.${t}`)&&(m.GUEST=document.getElementById(`guest.${e}.${t}`).value),this.populated,this.signedIn.push(m),7!==e&&this.updatePatrollerInfo(m.ID,m.TOTAL_DAYS)}document.getElementById(`name.${e}.${t}`).value=`${this.patrollers[n].FIRST_NAME} ${this.patrollers[n].LAST_NAME}`,document.getElementById(`rating.${e}.${t}`).value=this.patrollers[n].RATING}clearDiv(e,t){let n=this.signedIn.findIndex((n=>n.ID===Number(document.getElementById(`patrollerID.${e}.${t}`).value)));this.signedIn.splice(n,1),document.getElementById(`name.${e}.${t}`).value="",document.getElementById(`radioNum.${e}.${t}`).value="",document.getElementById(`rating.${e}.${t}`).value="",document.getElementById(`time.${e}.${t}`).value="","Night"!==this.dayNight&&(document.getElementById(`halfDay.${e}.${t}`).checked=!1),5!==e&&7!==e&&(document.getElementById(`guest.${e}.${t}`).value="",localStorage.removeItem(`${e}.${t}.guest`)),7===e?(document.getElementById("modalTitle").innerHTML="",document.getElementById("dataEntryDiv").innerHTML=""):("Day"===this.dayNight||"Night"===this.dayNight&&t>8)&&(document.getElementById(`person.${e}.${t}`).outerHTML="",this.extraNight=!1),localStorage.getItem(`${e}.${t}.position`)&&localStorage.removeItem(`${e}.${t}.position`),localStorage.removeItem(`${e}.${t}.cpr`),localStorage.removeItem(`${e}.${t}.name`),localStorage.removeItem(`${e}.${t}.time`),localStorage.removeItem(`${e}.${t}.scavenger`),localStorage.removeItem(`${e}.${t}.days`),localStorage.removeItem(`${e}.${t}.rating`),localStorage.removeItem(`${e}.${t}.id`),localStorage.removeItem(`${e}.${t}.todayHalf`),localStorage.removeItem(`${e}.${t}.halfDays`),localStorage.removeItem(`${e}.${t}.toboggan`),localStorage.removeItem(`${e}.${t}.chair`),localStorage.removeItem(`${e}.${t}.positionTeam`),localStorage.removeItem(`${e}.${t}.radio`),localStorage.removeItem(`${e}.${t}.team`),localStorage.removeItem(`${e}.${t}.nights`),localStorage.removeItem(`${e}.${t}.totalDays`),localStorage.removeItem(`${e}.${t}.snowmobile`)}handleHalfDay(e,t,n){let l=!1;(5===Number(e)||n)&&(l=!0),function(){if(document.getElementById(`halfDay.${e}.${t}`).checked){if(document.getElementById(`person.${e}.${t}`).style.backgroundColor="rgb(247,223,30)",l||(document.getElementById(`guest.${e}.${t}`).value="",document.getElementById(`guest.${e}.${t}`).disabled=!0),7===e)document.getElementById(`days.${e}.${t}`).value=Number(document.getElementById(`days.${e}.${t}`).value-.5);else if(!this.isLocalStorage)for(let n of this.signedIn)if(Number(n.ID)===Number(document.getElementById(`patrollerID.${e}.${t}`).value)){this.updatePatrollerInfo(n.ID,n.TOTAL_DAYS,"halfDaysUp");break}}else if(document.getElementById(`person.${e}.${t}`).style.backgroundColor="white",l||(document.getElementById(`guest.${e}.${t}`).disabled=!1),7===e){let n=Number(document.getElementById(`days.${e}.${t}`).value);document.getElementById(`days.${e}.${t}`).value=n+.5}else if(!this.isLocalStorage)for(let n of this.signedIn)if(Number(n.ID)===Number(document.getElementById(`patrollerID.${e}.${t}`).value)){this.updatePatrollerInfo(n.ID,n.TOTAL_DAYS,"halfDaysDown");break}}.bind(this)()}handleSignOffs(e,t){let n=function(n,l,d,o,a){if(1!==d){document.getElementById(`${n}.${e}.${t}`).style.color="rgb(204,75,55)";let d,i=!1;document.getElementById(`${n}.${e}.${t}`).addEventListener("click",d=()=>{let m=prompt("Password: ");for(let e of o)e.ID===m&&e.LEADER&&(i=!0);i?(this.signedIn[a][l]=1,document.getElementById(`${n}.${e}.${t}`).style.color="rgb(23,121,186)",document.getElementById(`${n}.${e}.${t}`).removeEventListener("click",d),document.getElementById(`${n}.${e}.${t}`).style.cursor="default",WebStorage.populateLocalStorage(this.signedIn[a],this.signedIn[a].POSITION_TEAM)):alert("Incorrect Password")})}else document.getElementById(`${n}.${e}.${t}`).style.color="rgb(23,121,186)",document.getElementById(`${n}.${e}.${t}`).style.cursor="default"}.bind(this);for(let l=0;l<this.signedIn.length;l++)if(Number(this.signedIn[l].ID)===Number(document.getElementById(`patrollerID.${e}.${t}`).value)){n("snowmobile","SNOWMOBILE",Number(this.signedIn[l].SNOWMOBILE),this.patrollers,l),n("toboggan","TOBOGGAN",Number(this.signedIn[l].TOBOGGAN),this.patrollers,l),n("scavenger","SCAVENGER",Number(this.signedIn[l].SCAVENGER),this.patrollers,l),n("cpr","CPR",Number(this.signedIn[l].CPR),this.patrollers,l),n("chair","CHAIR",Number(this.signedIn[l].CHAIR),this.patrollers,l);break}}static stopNaughtyKeys(){document.onkeydown=function(){switch(event.keyCode){case 13:case 169:case 116:return event.returnValue=!1,!1;case 82:if(event.ctrlKey)return event.returnValue=!1,!1}}}handlePrintFormButton(){document.getElementById("formSubmit").addEventListener("click",(e=>{if(e.stopImmediatePropagation(),"yes"===prompt("Are you sure you want to clear & print the roster? Please type:  yes")){this.updateDays(),document.getElementById("formSubmit").disabled=!0;for(let e of this.buttons)document.getElementById(e.id).disabled=!0;window.open("/src/views/results.ejs?x="+(new Date).getTime(),"_blank","location=yes,height=900,width=1000,scrollbars=yes,status=yes"),WebStorage.purgeLocalStorage(),window.location.href=window.location.href}}))}handleAdmin(e,t){let n=!1;document.getElementById(`admin.${e}.${t}`).addEventListener("click",(()=>{this.isAdmin=!0;let l=prompt("Password: ");for(let e of this.patrollers)e.ID===l&&e.LEADER&&(n=!0);if(n){const n=1,l=4;let d=prompt("Move to which team?");for(;!/^[0-9]+$/.test(d)||1!==d.length;)alert("You did not enter a number."),d=prompt("Move to which team?");if(d<n||d>l)alert("Incorrect team number.");else if(Number(d)===Number(e))alert("Patroller is already in this team!");else{let n=this.counter[d],l=new Event("click");document.getElementById(`joinTeam.${d}`).dispatchEvent(l),document.getElementById(`patrollerID.${d}.${n}`).value=document.getElementById(`patrollerID.${e}.${t}`).value,document.getElementById(`name.${d}.${n}`).value=document.getElementById(`name.${e}.${t}`).value,document.getElementById(`radioNum.${d}.${n}`).value=document.getElementById(`radioNum.${e}.${t}`).value,document.getElementById(`rating.${d}.${n}`).value=document.getElementById(`rating.${e}.${t}`).value,document.getElementById(`time.${d}.${n}`).value=document.getElementById(`time.${e}.${t}`).value,Number(d)===Number(6)&&(document.getElementById(`position.${d}.${n}`).value=document.getElementById(`position.${e}.${t}`).value),5!==e?document.getElementById(`guest.${d}.${n}`).value=document.getElementById(`guest.${e}.${t}`).value:document.getElementById(`guest.${d}.${n}`).style.display="none",document.getElementById(`halfDay.${e}.${t}`).checked&&(document.getElementById(`halfDay.${d}.${n}`).checked=!0,this.handleHalfDay(d,n)),document.getElementById(`halfDay.${d}.${n}`).addEventListener("click",(()=>{this.handleHalfDay(d,n)})),this.clearDiv(e,t);for(let e=0;e<this.patrollers.length;e++)if(Number(this.patrollers[e].ID)===Number(document.getElementById(`patrollerID.${d}.${n}`).value)){this.completeDivChange(d,n,e);break}this.updatePatrollerInfo(document.getElementById(`patrollerID.${d}.${n}`).value,document.getElementById(`radioNum.${d}.${n}`).value,"radio"),this.updatePatrollerInfo(document.getElementById(`patrollerID.${d}.${n}`).value,document.getElementById(`guestDiv.${d}.${n}`).value,"guest");for(let e of this.buttons)document.getElementById(e.id).disabled=!1}}else alert("Incorrect Password")}))}handleUndo(e,t,n){if(n){this.clearDiv(e,t),this.clearDiv(n,1),document.getElementById("modalTitle").innerHTML="",document.getElementById("dataEntryDiv").innerHTML="",document.getElementById("modalDiv").style.display="none";for(let e of this.buttons)document.getElementById(e.id).disabled=!1}else document.getElementById(`undo.${e}.${t}`).addEventListener("click",(()=>{this.clearDiv(e,t);for(let e of this.buttons)document.getElementById(e.id).disabled=!1}))}populatePage(){if(WebStorage.checkLocalStorage()){let e=new Event("change"),t=WebStorage.checkWhichForm();this.populated=1,!0==!document.getElementById("nightOverride").checked&&(this.isAdmin=!0),this.divTransition=!0,this.isLocalStorage=!0,"weekend"===t?(document.getElementById("weekendOverride").checked=!0,document.getElementById("weekendOverride").dispatchEvent(e)):"weekday"===t?(document.getElementById("weekdayOverride").checked=!0,document.getElementById("weekdayOverride").dispatchEvent(e)):(document.getElementById("nightOverride").checked=!0,document.getElementById("nightOverride").dispatchEvent(e)),this.signedIn=WebStorage.populateForm(t),"Night"===this.dayNight&&(this.counter[0]=this.signedIn.length+1),WebStorage.purgeLocalStorage(),WebStorage.populateLocalStorage(null,null,t);for(let e of this.signedIn)this.handleSignOffs(e.TEAM,e.POSITION_TEAM),WebStorage.populateLocalStorage(e,e.POSITION_TEAM);this.divTransition=!1,this.isLocalStorage=!1,this.isAdmin=!1,this.populated=0,document.getElementById("formSubmit").disabled=!1,this.handlePrintFormButton()}}updateDays(){for(let e=0;e<this.patrollers.length;e++)for(let t=0;t<this.signedIn.length;t++)if(Number(this.patrollers[e].ID)===Number(this.signedIn[t].ID)){this.patrollers[e].DAYS=this.signedIn[t].DAYS,this.patrollers[e].NIGHTS=this.signedIn[t].NIGHTS,this.patrollers[e].HALF_DAYS=this.signedIn[t].HALF_DAYS,this.patrollers[e].SNOWMOBILE=this.signedIn[t].SNOWMOBILE,this.patrollers[e].TOBOGGAN=this.signedIn[t].TOBOGGAN,this.patrollers[e].SCAVENGER=this.signedIn[t].SCAVENGER,this.patrollers[e].CPR=this.signedIn[t].CPR,this.patrollers[e].CHAIR=this.signedIn[t].CHAIR,this.patrollers[e].TODAY_HALF=this.signedIn[t].TODAY_HALF;break}fetch(document.url,{method:"POST",body:JSON.stringify(this.patrollers),headers:{"x-requested-with":"fetch.1",mode:"no-cors"}}).then((e=>{console.log(e.json())})),fetch(document.url,{method:"POST",body:JSON.stringify(this.signedIn),headers:{"x-requested-with":"fetch.2",mode:"no-cors"}}).then((e=>e.json()))}}